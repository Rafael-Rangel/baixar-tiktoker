# COMANDOS PARA COPIAR E COLAR NA VPS
# Execute um comando por vez

# ============================================
# OPÇÃO 1: Se o diretório já é um repositório git
# ============================================

cd ~/content-orchestrator && git fetch origin && git reset --hard origin/main && git pull origin main && cd ~ && docker compose build content-orchestrator && docker compose stop content-orchestrator && docker compose rm -f content-orchestrator && docker compose up -d content-orchestrator && sleep 5 && docker logs --tail 20 content-orchestrator

# ============================================
# OPÇÃO 2: Se o diretório NÃO é um repositório git (primeira vez)
# ============================================

cd ~ && mv content-orchestrator content-orchestrator_backup_$(date +%Y%m%d_%H%M%S) && git clone https://github.com/Rafael-Rangel/orquestrador.git content-orchestrator && cd content-orchestrator && cat > .env << 'EOF'
PROJECT_NAME=Content Orchestrator
API_V1_STR=/v1
STORAGE_TYPE=local
LOCAL_STORAGE_PATH=/app/downloads
DATA_PATH=/app/data
EOF
mkdir -p downloads logs data && chown -R 1000:1000 downloads logs data && cd ~ && docker compose build content-orchestrator && docker compose stop content-orchestrator && docker compose rm -f content-orchestrator && docker compose up -d content-orchestrator && sleep 5 && docker logs --tail 20 content-orchestrator

# ============================================
# OPÇÃO 3: Comandos separados (mais seguro)
# ============================================

# 1. Verificar se é repositório git
cd ~/content-orchestrator
ls -la .git

# Se .git existe, execute:
git fetch origin
git reset --hard origin/main
git pull origin main

# Se .git NÃO existe, execute:
cd ~
mv content-orchestrator content-orchestrator_backup_$(date +%Y%m%d_%H%M%S)
git clone https://github.com/Rafael-Rangel/orquestrador.git content-orchestrator

# 2. Criar .env
cd ~/content-orchestrator
cat > .env << 'EOF'
PROJECT_NAME=Content Orchestrator
API_V1_STR=/v1
STORAGE_TYPE=local
LOCAL_STORAGE_PATH=/app/downloads
DATA_PATH=/app/data
EOF

# 3. Criar diretórios
mkdir -p downloads logs data
chown -R 1000:1000 downloads logs data

# 4. Rebuild e reiniciar
cd ~
docker compose build content-orchestrator
docker compose stop content-orchestrator
docker compose rm -f content-orchestrator
docker compose up -d content-orchestrator

# 5. Verificar
sleep 5
docker ps | grep content-orchestrator
docker logs --tail 20 content-orchestrator
curl http://localhost:8002/health
curl http://localhost:8002/v1/n8n/health
